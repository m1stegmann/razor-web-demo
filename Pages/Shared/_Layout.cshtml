<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@2.0.3"></script>
    <script>
        // Fr端hzeitig Styles setzen, bevor der erste Paint passiert
        (function () {
            // Sobald der DOM geparst wurde (aber idealerweise schon vorher verf端gbar)
            const lazyObserver = new MutationObserver(() => {
                document.querySelectorAll('.lazy').forEach(el => {
                    el.style.setProperty('visibility', 'hidden', 'important');
                });
            });

            // Beobachte, wenn DOM weitergebaut wird (f端r noch nicht geparste lazy-Elemente)
            lazyObserver.observe(document.documentElement, {
                childList: true,
                subtree: true
            });

            // Erste Runde f端r bereits vorhandene `.lazy`-Elemente
            document.addEventListener("DOMContentLoaded", () => {
                document.querySelectorAll('.lazy').forEach(el => {
                    el.style.setProperty('visibility', 'hidden', 'important');
                });
                lazyObserver.disconnect(); // Falls nicht mehr gebraucht
            });
        })();
    </script>
</head>

<body class="bg-white text-white">
    <main class="max-w-[1024px] mx-auto p-4 space-y-2">
        @RenderBody()
    </main>
    <script>
        document.body.addEventListener('htmx:beforeSwap', function (event) {
            const target = event.detail.elt;
            const loginStatus = target.getAttribute('data-login-status');

            if (loginStatus) {
                const eventName = loginStatus === 'login' ? 'userLoggedOut' : 'userLoggedIn';
                document.body.dispatchEvent(new CustomEvent(eventName));
            }
        });
    </script>
</body>

</html>